/*!
 * fileLogger
 * Copyright 2015 Peter Bakondy https://github.com/pbakondy
 * See LICENSE in this repository for license information
 */
!function(){angular.module("fileLogger",["ngCordova"]).factory("$fileLogger",["$q","$window","$cordovaFile","$timeout",function(o,e,n,r){"use strict";function l(){return!e.cordova&&!e.PhoneGap&&!e.phonegap}function a(o){angular.isString(o)?(o=o.toUpperCase(),-1===h.indexOf(o)&&(o="INFO")):o="INFO";for(var e=(new Date).toJSON(),n=Array.prototype.slice.call(arguments,1),r=[e,o],a=0;a<n.length;a++)r.push(angular.isArray(n[a])?JSON.stringify(n[a]):angular.isObject(n[a])?JSON.stringify(n[a]):n[a]);if(l()){if(n.unshift(e),angular.isObject(console)&&angular.isFunction(console.log))switch(o){case"DEBUG":angular.isFunction(console.debug)?console.debug.apply(console,n):console.log.apply(console,n);break;case"INFO":angular.isFunction(console.debug)?console.info.apply(console,n):console.log.apply(console,n);break;case"WARN":angular.isFunction(console.debug)?console.warn.apply(console,n):console.log.apply(console,n);break;case"ERROR":angular.isFunction(console.debug)?console.error.apply(console,n):console.log.apply(console,n);break;default:console.log.apply(console,n)}}else console.log(r.join(" "));d.push({message:r.join(" ")+"\n"}),y||t()}function t(){if(!d.length)return void(y=!1);y=!0;var o=d.shift();c(o.message).then(function(){r(function(){t()})},function(){r(function(){t()})})}function c(r){var l=o.defer();return e.cordova?n.writeFile(m,r,{append:!0}).then(function(){l.resolve()},function(o){l.reject(o)}):(e.localStorage[m]||(e.localStorage[m]=""),e.localStorage[m]+=r,l.resolve()),l.promise}function i(){var r=o.defer();return e.cordova?n.readAsText(m).then(function(o){r.resolve(o)},function(o){r.reject(o)}):r.resolve(e.localStorage[m]),r.promise}function s(){var r=o.defer();return e.cordova?n.removeFile(m).then(function(o){r.resolve(o)},function(o){r.reject(o)}):(e.localStorage.removeItem(m),r.resolve()),r.promise}function u(o){return angular.isString(o)&&o.length>0?(m=o,!0):!1}function g(){var o=Array.prototype.slice.call(arguments,0);o.unshift("DEBUG"),a.apply(void 0,o)}function p(){var o=Array.prototype.slice.call(arguments,0);o.unshift("INFO"),a.apply(void 0,o)}function f(){var o=Array.prototype.slice.call(arguments,0);o.unshift("WARN"),a.apply(void 0,o)}function v(){var o=Array.prototype.slice.call(arguments,0);o.unshift("ERROR"),a.apply(void 0,o)}var d=[],y=!1,h=["DEBUG","INFO","WARN","ERROR"],m="messages.log";return{log:a,getLogfile:i,deleteLogfile:s,setStorageFilename:u,debug:g,info:p,warn:f,error:v}}])}();