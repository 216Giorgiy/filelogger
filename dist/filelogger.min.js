/*!
 * fileLogger
 * Copyright 2015 Peter Bakondy https://github.com/pbakondy
 * See LICENSE in this repository for license information
 */
!function(){angular.module("fileLogger",["ngCordova"]).factory("$fileLogger",["$q","$window","$cordovaFile","$timeout",function(e,o,n,l){"use strict";function r(e){angular.isString(e)?(e=e.toUpperCase(),-1===f.indexOf(e)&&(e="INFO")):e="INFO";for(var o=(new Date).toJSON(),n=Array.prototype.slice.call(arguments,1),l=[o,e],r=0;r<n.length;r++)l.push(angular.isArray(n[r])?JSON.stringify(n[r]):angular.isObject(n[r])?JSON.stringify(n[r]):n[r]);if(n.unshift(o),angular.isObject(console)&&angular.isFunction(console.log))switch(e){case"DEBUG":angular.isFunction(console.debug)?console.debug.apply(console,n):console.log.apply(console,n);break;case"INFO":angular.isFunction(console.debug)?console.info.apply(console,n):console.log.apply(console,n);break;case"WARN":angular.isFunction(console.debug)?console.warn.apply(console,n):console.log.apply(console,n);break;case"ERROR":angular.isFunction(console.debug)?console.error.apply(console,n):console.log.apply(console,n);break;default:console.log.apply(console,n)}u.push({message:l.join(" ")+"\n"}),g||a()}function a(){if(!u.length)return void(g=!1);g=!0;var e=u.shift();t(e.message).then(function(){l(function(){a()})},function(){l(function(){a()})})}function t(l){var r=e.defer();return o.cordova?n.writeFile(p,l,{append:!0}).then(function(){r.resolve()},function(e){r.reject(e)}):(o.localStorage[p]||(o.localStorage[p]=""),o.localStorage[p]+=l,r.resolve()),r.promise}function c(){var l=e.defer();return o.cordova?n.readAsText(p).then(function(e){l.resolve(e)},function(e){l.reject(e)}):l.resolve(o.localStorage[p]),l.promise}function s(){var l=e.defer();return o.cordova?n.removeFile(p).then(function(e){l.resolve(e)},function(e){l.reject(e)}):(o.localStorage.removeItem(p),l.resolve()),l.promise}function i(e){return angular.isString(e)&&e.length>0?(p=e,!0):!1}var u=[],g=!1,f=["DEBUG","INFO","WARN","ERROR"],p="messages.log";return{log:r,getLogfile:c,deleteLogfile:s,setStorageFilename:i}}])}();